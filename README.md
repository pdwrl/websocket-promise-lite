## What is it?

This is an Axios for WebSockets :-)

## For what?

To easily work with sockets in async / await style.

## Installation
```
npm i websocket-promise-lite
```

## How to use?
```javascript
import WebsocketPromiseLiteClient from 'websocket-promise-lite'

const demoFunc = async () => {
	const WS = new WebsocketPromiseLiteClient({
		url: 'wss://ws.postman-echo.com/raw'
	})
	await WS.connectionEstablished()
	const answer = await WS.send({
		myMessage: 'hello websocket!'
	})
	console.log(answer)

	// next actions ...

	WS.close()
}

demoFunc()
```
## Important!

Back-end (websocket server) have to answer with the same "messageId" parameter!

## API

### methods

- __connectionEstablished()__: waits while connection opens. If fails it reconnects automatically
- __send(message)__: sending any data to Websocket server. Message have to be an object.
- __close()__: closes Websocket at normal way (code 1000)

```javascript
const WS = new WebsocketPromiseLiteClient(config)
```
where __config__ is an object with a possible properties:

### parameters

__url__: url with protocol. The only required parameter

__maxNumberOfReconnects__: maximum number of reconnections, after which there will be no more reconnections. If 0 then infinite. If -1 then will be no reconnections. Default 0.

__pauseBetweenReconnects__: pause between reconnections (in ms). If 0 then reconnections will become after randomized pause. Pauses are stored in array [xyz, 3xyz, 5xyz, 8xyz, 12xyz, 17xyz ... 17xyz], where xyz is random number. This is so that all clients reconnects at different time for stable back-end. Default 0.

__connectTimeout__: time in ms after which connection is considered unsuccessful (and then reconnects again)

__serializer__: serializer function to prepare for sending. For example, CBOR.encode. Default JSON.stringify.

__deserializer__: deserializer function to prepare for receiving. For example, CBOR.decode. Default JSON.parse.

__binaryType__: type of data to be transmitted. In most cases it's "arraybuffer". But You may specify it as "blob. Default "arraybuffer".

__urlAdditionalGenerator__: use it when second url part have to be generated by some algorythm. Pass a function.

### events

__onConnectionOpen__: fires when connection has been successfully opened. No data returns.

__onConnectionClose__: fires when connection has been closed. Returns (code, byTimer). __code__ is websocket's close code. __byTimer__ is boolean, returns true if connection has been closed by timeout (__connectTimeout__ parameter)

__onConnectionReOpen__: fires when connection has been successfully reopened. No data returns.

__onBeforeReOpen__: fires before try to reopen connection. Returns (attemptNum, attemptsTotal), where __attemptNum__ is a number of attempts, __attemptTotal__ is a max number of attempts (__maxNumberOfReconnects__ parameter)

__onNotPromisedData__: fires when not promised data received. For example, if server needs to notify about changes immediately. Returns (message)

## Tips

- Don't serialize data before sending via websocket-promise-lite. All the data is serialized by lib before sending.
- if You want to send not "real object" data (number, string, array), websocket-promise-lite will bring the data to the object.
- Library adds "messageId" field to object You are sending. Make sure Your data object has no field with the same name.
